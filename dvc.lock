schema: '2.0'
stages:
  preprocess:
    cmd: python -u source/preprocess.py
    deps:
    - path: data/raw/
      hash: md5
      md5: 25e54827bb56e0446b074ca8411aec84.dir
      size: 39391890330
      nfiles: 305982
    - path: source/preprocess.py
      hash: md5
      md5: 384ea4345776f9d6e3e5371e6eec5dea
      size: 17607
    params:
      params.yaml:
        preprocess:
          batch_size: 8
          db_writemap: false
          ext:
          - wav
          initial_db_size: 1
          input_path_test: data/raw/nsynth-test
          input_path_train: data/raw/nsynth-train
          input_path_valid: data/raw/nsynth-valid
          model_name: facebook/encodec_24khz
          num_workers: 30
          output_path_test: data/processed/test
          output_path_train: data/processed/train
          output_path_valid: data/processed/valid
          sample_rate: 24000
    outs:
    - path: data/processed/
      hash: md5
      md5: 6e310ab2456715138e33193d0554577d.dir
      size: 130354565120
      nfiles: 6
  train_vae:
    cmd: python -u source/train_vae.py
    deps:
    - path: source/train_vae.py
      hash: md5
      md5: e2e34ea83071763cca97933c6ec87927
      size: 12741
    - path: source/vae.py
      hash: md5
      md5: 0119b38654c0e6777d51fd374684d59d
      size: 9045
    params:
      params.yaml:
        train:
          db_path_test: data/processed/test
          db_path_train: data/processed/train
          db_path_valid: data/processed/valid
          num_workers: 0
          pitch:
          - 53
          - 54
          - 55
          - 56
          - 57
          - 58
          - 59
          - 60
          - 61
          - 62
          - 63
          - 64
          random_seed: 42
          vae:
            batch_size: 256
            betas:
            - 0.9
            - 0.95
            calculate_vae_loss:
              _partial_: true
              _target_: vae.calculate_vae_loss
              batch_size: 256
              cls_loss_fn:
                _target_: torch.nn.CrossEntropyLoss
              epochs: 2000
              loss_fn:
                _target_: torch.nn.MSELoss
                reduction: sum
              weighted_reproduction: false
            channels:
            - 128
            - 256
            - 512
            - 1024
            - 2048
            - 4096
            dropout_ratio: 0.2
            epochs: 2000
            input_crop: 150
            linears:
            - 16384
            - 8192
            - 4096
            - 2048
            - 1024
            - 512
            - 2
            lr: 0.0001
            wd: 0.05
    outs:
    - path: out/
      hash: md5
      md5: caa6498a40e0bd0448aa5f11769fd288.dir
      size: 4565715370
      nfiles: 10
